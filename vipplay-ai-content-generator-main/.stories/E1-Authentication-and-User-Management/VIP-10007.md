# VIP-10007: User Preferences & Settings

**Story ID**: VIP-10007
**Story Type**: Story
**Epic**: E1-Authentication-and-User-Management
**Priority**: Medium
**Story Points**: 3
**Status**: In Progress

## User Story

As a user, I want to customize my preferences so that the platform works according to my needs

## Acceptance Criteria

- [x] **AC1**: User can retrieve current preferences
- [x] **AC2**: User can update specific preferences (PATCH - merge)
- [x] **AC3**: User can replace all preferences (PUT - replace)
- [x] **AC4**: User can reset preferences to defaults (DELETE)
- [x] **AC5**: Preferences validated for theme, notifications, tone, word count
- [x] **AC6**: Changes persist to database with updatedAt timestamp

## Technical Details

**Endpoint**: `/api/protected/preferences`

**Methods**:

1. **GET** - Retrieve current preferences
   - Returns: `{ success: true, preferences: {...} }`

2. **PATCH** - Update specific preferences (merge with existing)
   - Body: Any combination of `theme`, `emailNotifications`, `defaultTone`, `defaultWordCount`
   - Example: `{ "theme": "dark", "defaultWordCount": 2000 }`
   - Merges with existing preferences

3. **PUT** - Replace all preferences
   - Body: Complete preferences object
   - Sets defaults for omitted fields
   - Replaces entire preferences object

4. **DELETE** - Reset to defaults
   - No body required
   - Resets to: `{ theme: "system", emailNotifications: true, defaultTone: "Professional", defaultWordCount: 1500 }`

**Preference Fields**:
- `theme`: "light" | "dark" | "system"
- `emailNotifications`: boolean
- `defaultTone`: string (e.g., "Professional", "Casual", "Formal")
- `defaultWordCount`: number (100-5000)

**Default Preferences**:
```json
{
  "theme": "system",
  "emailNotifications": true,
  "defaultTone": "Professional",
  "defaultWordCount": 1500
}
```

**Files Created**:
- `app/api/protected/preferences/route.ts` - Full CRUD for preferences

**HTTP Methods Comparison**:
- **PATCH**: Partial update, merge with existing (update dark mode only)
- **PUT**: Full replacement, sets defaults for missing fields (reset all but keep some)
- **DELETE**: Reset to system defaults (start fresh)

**Validation**:
- Theme must be enum: light, dark, system
- Email notifications must be boolean
- Default tone is any string
- Word count: 100-5000 range

## Definition of Done

- [x] Code implemented and working
- [x] All acceptance criteria met
- [ ] Unit tests written and passing
- [ ] Code reviewed and approved
- [ ] Merged to main branch
- [x] Documented

## Notes

- Depends on VIP-10006 (User Profile Management)
- Preferences also updateable via PATCH /api/protected/me (profile endpoint)
- This endpoint provides dedicated preferences management
- PATCH merges (recommended for UX - preserve other settings)
- PUT replaces (useful for "restore defaults" with some overrides)
- DELETE resets completely (simplest default restoration)
- All methods authenticated via withAuth middleware
