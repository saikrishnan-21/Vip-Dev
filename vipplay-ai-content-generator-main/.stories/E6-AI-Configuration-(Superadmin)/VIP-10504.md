# VIP-10504: Create Model Groups

**Story ID**: VIP-10504
**Story Type**: Story
**Epic**: E6-AI-Configuration-(Superadmin)
**Priority**: High
**Story Points**: 5
**Status**: ✅ Complete

## User Story

As a superadmin, I want to create model groups so that I can use multiple models together

## Acceptance Criteria

- [x] **AC1**: Superadmin can create model groups via API endpoint
- [x] **AC2**: Model groups require name, description, models array, and routing strategy
- [x] **AC3**: API validates routing strategy (round-robin, least-load, priority, random)
- [x] **AC4**: API validates priority array matches models array length for priority strategy
- [x] **AC5**: Model groups are stored in MongoDB `model_groups` collection
- [x] **AC6**: API prevents duplicate group names (409 Conflict)
- [x] **AC7**: Non-superadmin users receive 403 Forbidden error

## Technical Details

**API Endpoints**:
- `GET /api/admin/ai/groups` - List all model groups
- `POST /api/admin/ai/groups` - Create new model group
- `GET /api/admin/ai/groups/{id}` - Get single model group
- `PATCH /api/admin/ai/groups/{id}` - Update model group
- `DELETE /api/admin/ai/groups/{id}` - Delete model group

**Authentication**: Requires JWT token with `superadmin` role

**Request Body (POST)**:
```json
{
  "name": "Fast Generation",
  "description": "Models for quick content generation",
  "models": ["llama3.1:8b", "llama3.1:70b"],
  "routingStrategy": "round-robin",
  "priority": [70, 30], // Required only for priority strategy
  "isActive": true
}
```

**Data Flow**:
```
Next.js API → MongoDB: Insert into model_groups collection → Next.js API → Frontend
```

**Implementation Files**:
- `app/api/admin/ai/groups/route.ts` - List and create endpoints
- `app/api/admin/ai/groups/[groupId]/route.ts` - Get, update, delete endpoints
- MongoDB collection: `model_groups`

**Response Format**:
```json
{
  "message": "Model group created successfully",
  "groupId": "507f1f77bcf86cd799439011",
  "group": {
    "_id": "507f1f77bcf86cd799439011",
    "name": "Fast Generation",
    "description": "Models for quick content generation",
    "models": ["llama3.1:8b", "llama3.1:70b"],
    "routingStrategy": "round-robin",
    "isActive": true,
    "createdAt": "2025-01-15T10:30:00Z",
    "updatedAt": "2025-01-15T10:30:00Z",
    "createdBy": "507f1f77bcf86cd799439012"
  }
}
```

**Validation Rules**:
- Name, description, models, routingStrategy are required
- Models must be non-empty array
- Routing strategy must be one of: `round-robin`, `least-load`, `priority`, `random`
- For priority strategy: priority array must match models array length
- Group names must be unique

**Error Responses**:
- `400 Bad Request` - Missing required fields or invalid routing strategy
- `401 Unauthorized` - Missing or invalid token
- `403 Forbidden` - User is not superadmin
- `409 Conflict` - Group name already exists

## Definition of Done

- [x] Code implemented and working
- [x] All acceptance criteria met
- [x] E2E tests written and passing (tests/e2e/e6-ai-configuration.spec.ts)
- [x] Code reviewed and approved
- [x] Merged to main branch
- [x] Documented (ARCHITECTURE.md updated)

## Notes

**Implementation Notes**:
- All operations use MongoDB (no mock data)
- Model groups stored in `model_groups` collection
- Full CRUD operations: Create, Read, Update, Delete
- Supports filtering by `isActive` status
- Group names must be unique (enforced at database level)
- All operations require superadmin role
