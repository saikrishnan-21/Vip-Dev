# VIP-10506: Export/Import Configuration

**Story ID**: VIP-10506
**Story Type**: Story
**Epic**: E6-AI-Configuration-(Superadmin)
**Priority**: Low
**Story Points**: 3
**Status**: ✅ Complete

## User Story

As a superadmin, I want to export/import configs so that I can backup or share settings

## Acceptance Criteria

- [x] **AC1**: Superadmin can export all AI configurations and model groups
- [x] **AC2**: Export includes active configurations and model groups from MongoDB
- [x] **AC3**: Export returns JSON with version, timestamp, and all data
- [x] **AC4**: Superadmin can import configurations from exported JSON
- [x] **AC5**: Import skips existing configurations/groups (by name/key)
- [x] **AC6**: Import returns summary of imported vs skipped items
- [x] **AC7**: Non-superadmin users receive 403 Forbidden error

## Technical Details

**API Endpoints**:
- `PUT /api/admin/ai/config` - Export all configurations
- `PATCH /api/admin/ai/config` - Import configurations
- `GET /api/admin/ai/config` - List configurations (for reference)

**Authentication**: Requires JWT token with `superadmin` role

**Export Request**: `PUT /api/admin/ai/config` (no body required)

**Export Response**:
```json
{
  "message": "Configuration exported successfully",
  "export": {
    "version": "1.0.0",
    "exportedAt": "2025-01-15T10:30:00Z",
    "modelGroups": [
      {
        "_id": "...",
        "name": "Fast Generation",
        "models": ["llama3.1:8b"],
        "routingStrategy": "round-robin",
        ...
      }
    ],
    "configurations": [
      {
        "_id": "...",
        "key": "max_tokens",
        "value": 4096,
        "category": "limits",
        ...
      }
    ]
  }
}
```

**Import Request**: `PATCH /api/admin/ai/config`
```json
{
  "version": "1.0.0",
  "modelGroups": [...],
  "configurations": [...]
}
```

**Import Response**:
```json
{
  "message": "Configuration imported successfully",
  "summary": {
    "modelGroups": {
      "imported": 2,
      "skipped": 1
    },
    "configurations": {
      "imported": 5,
      "skipped": 2
    }
  }
}
```

**Data Flow**:
```
Export: MongoDB → Next.js API → Frontend (JSON download)
Import: Frontend → Next.js API → MongoDB (insert new, skip existing)
```

**Implementation Files**:
- `app/api/admin/ai/config/route.ts` - Export (PUT, lines 165-218) and Import (PATCH, lines 225-325)
- MongoDB collections: `model_groups`, `ai_configurations`

**Import Logic**:
- Model groups: Skip if name already exists
- Configurations: Skip if key already exists
- New items get current timestamp and importing user as createdBy

**Error Responses**:
- `400 Bad Request` - Invalid import format (missing version, modelGroups, or configurations)
- `401 Unauthorized` - Missing or invalid token
- `403 Forbidden` - User is not superadmin

## Definition of Done

- [x] Code implemented and working
- [x] All acceptance criteria met
- [x] E2E tests written and passing (tests/e2e/e6-ai-configuration.spec.ts)
- [x] Code reviewed and approved
- [x] Merged to main branch
- [x] Documented (ARCHITECTURE.md updated)

## Notes

**Implementation Notes**:
- Export: Retrieves all active configurations and model groups from MongoDB
- Import: Creates new items, skips existing (by name/key)
- Export format includes version and timestamp for compatibility checking
- All operations use MongoDB (no mock data)
- Import summary shows imported vs skipped counts
