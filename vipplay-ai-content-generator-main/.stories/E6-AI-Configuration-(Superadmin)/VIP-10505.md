# VIP-10505: Configure Routing Strategies

**Story ID**: VIP-10505
**Story Type**: Story
**Epic**: E6-AI-Configuration-(Superadmin)
**Priority**: Medium
**Story Points**: 5
**Status**: âœ… Complete

## User Story

As a superadmin, I want to configure routing strategies so that I can optimize model usage

## Acceptance Criteria

- [x] **AC1**: Superadmin can configure routing strategies when creating model groups
- [x] **AC2**: Supported strategies: round-robin, least-load, priority, random
- [x] **AC3**: Priority strategy requires priority array matching models array length
- [x] **AC4**: API validates routing strategy on create and update
- [x] **AC5**: Routing strategy configuration is stored in MongoDB with model group
- [x] **AC6**: Invalid routing strategy returns 400 Bad Request

## Technical Details

**Note**: Routing strategies are configured as part of model group creation/update (VIP-10504).

**API Endpoints**: Same as VIP-10504 (model groups endpoints)

**Routing Strategies**:
1. **round-robin** - Distribute requests evenly across models
2. **least-load** - Route to model with least active requests (future implementation)
3. **priority** - Route based on priority weights (requires priority array)
4. **random** - Randomly select from available models

**Request Body Example (Priority Strategy)**:
```json
{
  "name": "Quality Generation",
  "description": "High-quality models with priority routing",
  "models": ["llama3.1:70b", "llama3.1:8b"],
  "routingStrategy": "priority",
  "priority": [80, 20], // 80% to first model, 20% to second
  "isActive": true
}
```

**Implementation Files**:
- `app/api/admin/ai/groups/route.ts` - Validation logic (lines 117-133)
- `app/api/admin/ai/groups/[groupId]/route.ts` - Update validation (lines 157-180)
- MongoDB collection: `model_groups` (routingStrategy field)

**Validation**:
- Routing strategy must be one of the 4 supported strategies
- Priority array required only when routingStrategy is "priority"
- Priority array length must match models array length
- Priority values should be positive numbers (validation recommended)

**Error Responses**:
- `400 Bad Request` - Invalid routing strategy or missing priority array for priority strategy

## Definition of Done

- [x] Code implemented and working
- [x] All acceptance criteria met
- [x] E2E tests written and passing (tests/e2e/e6-ai-configuration.spec.ts)
- [x] Code reviewed and approved
- [x] Merged to main branch
- [x] Documented (ARCHITECTURE.md updated)

## Notes

**Implementation Notes**:
- Routing strategies are part of model group configuration (VIP-10504)
- Strategies stored in MongoDB `model_groups` collection
- Validation ensures priority array matches models array for priority strategy
- Supported strategies: round-robin, least-load, priority, random
- Future: Routing logic will use these strategies for model selection
