# VIP-10200: Next.js Swagger/OpenAPI Documentation Setup

**Story ID**: VIP-10200
**Story Type**: Story
**Epic**: E3-Content-Generation-(AI)
**Priority**: High
**Story Points**: 3
**Status**: To Do

## User Story

As a developer, I want comprehensive API documentation so that I can understand and test all Next.js endpoints

## Acceptance Criteria

- [ ] **AC1**: Swagger UI accessible at `/api-docs` route
- [ ] **AC2**: OpenAPI 3.0 specification generated automatically from Next.js API routes
- [ ] **AC3**: All existing endpoints documented (auth, users, sources, articles, content, media)
- [ ] **AC4**: Request/response schemas defined with examples
- [ ] **AC5**: Authentication requirements documented (JWT bearer token)
- [ ] **AC6**: API documentation updates automatically when routes change

## Technical Details

**Architecture:**
- Next.js API documentation using `next-swagger-doc` library
- OpenAPI 3.0 specification
- Swagger UI for interactive API testing
- Auto-generated from JSDoc comments and TypeScript types

**Implementation:**

1. **Install Dependencies:**
```bash
pnpm add next-swagger-doc swagger-ui-react
pnpm add -D @types/swagger-ui-react
```

2. **Create OpenAPI Spec Generator** (`lib/swagger.ts`):
```typescript
import { createSwaggerSpec } from 'next-swagger-doc';

export const getApiDocs = async () => {
  const spec = createSwaggerSpec({
    apiFolder: 'app/api',
    definition: {
      openapi: '3.0.0',
      info: {
        title: 'VIPContentAI API Documentation',
        version: '1.0.0',
        description: 'AI-powered content generation platform API',
        contact: {
          name: 'VIPContentAI Support',
          email: 'support@vipcontentai.com',
        },
      },
      servers: [
        {
          url: 'http://localhost:3000',
          description: 'Development server',
        },
        {
          url: 'https://api.vipcontentai.com',
          description: 'Production server',
        },
      ],
      components: {
        securitySchemes: {
          BearerAuth: {
            type: 'http',
            scheme: 'bearer',
            bearerFormat: 'JWT',
            description: 'Enter JWT token obtained from /api/auth/login',
          },
        },
      },
      security: [
        {
          BearerAuth: [],
        },
      ],
    },
  });
  return spec;
};
```

3. **Create Swagger UI Page** (`app/api-docs/page.tsx`):
```typescript
'use client';

import dynamic from 'next/dynamic';
import 'swagger-ui-react/swagger-ui.css';

const SwaggerUI = dynamic(() => import('swagger-ui-react'), { ssr: false });

export default function ApiDocsPage() {
  return (
    <div className="swagger-ui-container">
      <SwaggerUI url="/api/swagger.json" />
    </div>
  );
}
```

4. **Create Spec Endpoint** (`app/api/swagger.json/route.ts`):
```typescript
import { NextResponse } from 'next/server';
import { getApiDocs } from '@/lib/swagger';

export async function GET() {
  const spec = await getApiDocs();
  return NextResponse.json(spec);
}
```

5. **Add JSDoc Comments to Existing Routes**:

Example for `app/api/auth/login/route.ts`:
```typescript
/**
 * @swagger
 * /api/auth/login:
 *   post:
 *     summary: User login
 *     description: Authenticate user and receive JWT token
 *     tags: [Authentication]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             required:
 *               - email
 *               - password
 *             properties:
 *               email:
 *                 type: string
 *                 format: email
 *                 example: admin@vipcontentai.com
 *               password:
 *                 type: string
 *                 format: password
 *                 example: SecurePass123!
 *     responses:
 *       200:
 *         description: Login successful
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 success:
 *                   type: boolean
 *                   example: true
 *                 token:
 *                   type: string
 *                   example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
 *                 user:
 *                   type: object
 *                   properties:
 *                     email:
 *                       type: string
 *                     role:
 *                       type: string
 *                       enum: [user, editor, admin, superadmin]
 *       401:
 *         description: Invalid credentials
 *       400:
 *         description: Validation error
 */
export async function POST(request: NextRequest) {
  // ... existing implementation
}
```

**Endpoints to Document:**

1. **Authentication** (`/api/auth/*`):
   - POST /api/auth/login
   - POST /api/auth/register
   - POST /api/auth/logout
   - POST /api/auth/forgot-password
   - POST /api/auth/reset-password

2. **Users** (`/api/users/*`):
   - GET /api/users/me
   - PUT /api/users/me
   - PUT /api/users/me/password

3. **Sources** (`/api/sources/*`):
   - GET /api/sources
   - POST /api/sources
   - GET /api/sources/{id}
   - PUT /api/sources/{id}
   - DELETE /api/sources/{id}
   - POST /api/sources/{id}/sync

4. **Articles** (`/api/articles/*`):
   - GET /api/articles
   - POST /api/articles
   - GET /api/articles/{id}
   - PUT /api/articles/{id}
   - DELETE /api/articles/{id}
   - GET /api/articles/search
   - GET /api/articles/semantic-search
   - POST /api/articles/{id}/embeddings

5. **Topics** (`/api/topics/*`):
   - GET /api/topics
   - POST /api/topics
   - GET /api/topics/{id}
   - PUT /api/topics/{id}
   - DELETE /api/topics/{id}

6. **Generated Content** (`/api/content/*`):
   - GET /api/content
   - POST /api/content
   - GET /api/content/{id}
   - PUT /api/content/{id}
   - DELETE /api/content/{id}

7. **Media** (`/api/media/*`):
   - GET /api/media
   - POST /api/media
   - GET /api/media/{id}
   - DELETE /api/media/{id}

**Configuration:**

Add to `next.config.js`:
```javascript
const nextConfig = {
  // ... existing config
  async rewrites() {
    return [
      {
        source: '/api-docs',
        destination: '/api-docs',
      },
    ];
  },
};
```

**Error Handling:**
- Handle missing JSDoc comments gracefully
- Provide helpful error messages for malformed specs
- Validate OpenAPI schema before serving

**Testing:**
1. Access `/api-docs` in browser
2. Verify all endpoints are listed
3. Test authentication with JWT token
4. Execute sample requests via Swagger UI
5. Verify request/response schemas match actual implementation

## Definition of Done

- [ ] `next-swagger-doc` installed and configured
- [ ] Swagger UI accessible at `/api-docs`
- [ ] OpenAPI 3.0 spec generated at `/api/swagger.json`
- [ ] All existing API routes documented with JSDoc comments
- [ ] Authentication documented (JWT bearer token)
- [ ] Request/response schemas defined with examples
- [ ] Tested all documented endpoints via Swagger UI
- [ ] Documentation reviewed and approved
- [ ] Code merged to dev branch

## Notes

**Why This is the First E3 Story:**
- Establishes API documentation foundation before building new features
- Makes it easier to understand Next.js â†” FastAPI contract
- Enables testing of existing endpoints (E1, E2 already implemented)
- Industry best practice for REST APIs
- Improves developer onboarding experience

**Benefits:**
- Interactive API testing without Postman
- Auto-generated documentation (stays in sync with code)
- Clear contract definition for frontend developers
- Easier debugging and troubleshooting
- Professional API presentation

**Related Documentation:**
- next-swagger-doc: https://github.com/jellydn/next-swagger-doc
- OpenAPI 3.0 Spec: https://swagger.io/specification/
- Swagger UI: https://swagger.io/tools/swagger-ui/

**Implementation Order:**
1. Install dependencies
2. Create swagger.ts utility
3. Create /api/swagger.json endpoint
4. Create /api-docs page with Swagger UI
5. Add JSDoc comments to 5-10 key endpoints
6. Test and verify
7. Document remaining endpoints incrementally

**Future Enhancements:**
- Add API versioning (v1, v2)
- Generate TypeScript client SDK from OpenAPI spec
- Add code examples in multiple languages
- Integrate with API monitoring tools
