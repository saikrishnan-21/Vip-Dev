# VIP-10305: Reject Content with Notes

**Story ID**: VIP-10305
**Story Type**: Story
**Epic**: E4-Content-Management-and-Review
**Priority**: Medium
**Story Points**: 3
**Status**: In Progress

## User Story

As a user, I want to reject content and provide notes/feedback so that I can explain why it wasn't approved and guide improvements

## Acceptance Criteria

- [ ] **AC1**: User can click "Reject" button to open rejection dialog
- [ ] **AC2**: Rejection dialog has a text area for notes/feedback (required field)
- [ ] **AC3**: Notes are validated: non-empty, 10-500 characters
- [ ] **AC4**: Rejection moves content status from pending â†’ rejected
- [ ] **AC5**: Rejection reason is stored and visible in content details
- [ ] **AC6**: Rejected content can be re-submitted for approval (regenerated)
- [ ] **AC7**: User sees confirmation of successful rejection with toast message
- [ ] **AC8**: Rejection is logged with rejector user ID and timestamp
- [ ] **AC9**: Only content in "pending" or "approved" status can be rejected
- [ ] **AC10**: User isolation enforced - can only reject own content

## Technical Details

### Backend (To Be Implemented)
- **Endpoint**: `POST /api/content/[contentId]/reject` (new endpoint)
- **Request Body**:
  ```json
  {
    "action": "reject",
    "notes": "string (10-500 chars, required)"
  }
  ```
- **Response**:
  ```json
  {
    "success": true,
    "content": {
      "_id": "string",
      "status": "rejected",
      "rejectionReason": "string",
      "rejectedAt": "ISO date",
      "rejectedBy": "user ID"
    },
    "message": "Content rejected successfully"
  }
  ```
- **Status Validation**:
  - Allow reject only if: `status === 'pending' || status === 'approved'`
  - Return 400 if already rejected or published
- **User Isolation**: Must check `content.userId === user.userId`
- **Notes Field**: Store in `rejectionReason` or `rejectionNotes` field
- **Timestamp**: Set `rejectedAt` and `rejectedBy` on rejection

### Frontend (To Be Implemented)
- **Component**: Reject dialog in content detail view (VIP-10302)
- **Requirements**:
  - "Reject" button visible only for pending/approved content
  - Click opens modal with textarea for notes
  - Text area placeholder: "Provide feedback for improvement..."
  - Character counter: Show "X/500 characters"
  - Submit button disabled until notes are 10+ characters
  - Loading state during API call
  - Success/error toast messages
  - Update content status immediately

### Dialog Content
- Title: "Reject Content?"
- Labels: "Content: {title}"
- Textarea: "Rejection Notes (required, 10-500 characters)"
- Buttons: "Cancel", "Reject"

### Database Changes
- Set `status: 'rejected'`
- Set `rejectionReason: notes` (or `rejectionNotes: notes`)
- Set `rejectedAt: new Date()`
- Set `rejectedBy: user.userId`
- Update `updatedAt: new Date()`

### Data Model Update Needed
Add to `generated_content` schema if not present:
- `rejectionReason`: string (max 500)
- `rejectedAt`: date
- `rejectedBy`: ObjectId (user reference)

## Definition of Done

- [x] Story details defined
- [ ] Create POST /api/content/[contentId]/reject endpoint
- [ ] Add rejectionReason, rejectedAt, rejectedBy to schema
- [ ] Add input validation (notes: 10-500 chars)
- [ ] Frontend reject dialog implemented
- [ ] Character counter implemented
- [ ] Notes validation on client and server
- [ ] Success/error handling with toasts
- [ ] Optimistic UI updates
- [ ] All acceptance criteria met
- [ ] Unit tests written
- [ ] E2E tests passing
- [ ] Code reviewed and approved
- [ ] Merged to main branch

## Security Notes

### Validation Requirements
- Client-side validation: Notes length
- Server-side validation: Notes required, 10-500 chars, non-empty after trim
- XSS prevention: Escape notes when displaying

### Authorization
- All authenticated users can reject their own content
- Cannot reject other users' content
- Verify ownership before allowing rejection

## Related Stories
- VIP-10302: View Content Details (rejection button location)
- VIP-10304: Approve Content (opposite workflow)
- VIP-10306: Bulk Operations (reject multiple)

## Notes

- New endpoint to create (POST /api/content/[contentId]/reject)
- Need to add rejection fields to database schema
- Consider sending notification when content is rejected
- User can regenerate rejected content from generator (separate feature)
