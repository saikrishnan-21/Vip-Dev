# VIP-10306: Bulk Operations

**Story ID**: VIP-10306
**Story Type**: Story
**Epic**: E4-Content-Management-and-Review
**Priority**: High
**Story Points**: 5
**Status**: In Progress

## User Story

As a user, I want to approve, reject, or delete multiple content items at once so that I can manage content more efficiently and save time on repetitive tasks

## Acceptance Criteria

- [ ] **AC1**: User can select multiple content items using checkboxes
- [ ] **AC2**: User can select all items on current page with "Select All" checkbox
- [ ] **AC3**: Selected items count is displayed (e.g., "5 selected")
- [ ] **AC4**: Bulk action buttons appear when items are selected: Approve, Reject, Delete
- [ ] **AC5**: User can perform bulk approve on all selected items
- [ ] **AC6**: User can perform bulk reject with single rejection note (applies to all)
- [ ] **AC7**: User can perform bulk delete with confirmation dialog
- [ ] **AC8**: Progress indicator shows during bulk operation (e.g., "3/5 processed")
- [ ] **AC9**: Success message shows count of items successfully processed
- [ ] **AC10**: Failed items are reported with error details for user review

## Technical Details

### Backend (To Be Implemented)
- **Endpoint**: `POST /api/content/bulk-actions` (new endpoint)
- **Request Body**:
  ```json
  {
    "action": "approve|reject|delete",
    "contentIds": ["id1", "id2", "id3"],
    "rejectionNotes": "optional string for reject action"
  }
  ```
- **Response**:
  ```json
  {
    "success": true,
    "processed": 3,
    "failed": 0,
    "results": [
      {
        "contentId": "id1",
        "status": "success",
        "message": "Approved successfully"
      },
      {
        "contentId": "id2",
        "status": "success",
        "message": "Rejected successfully"
      }
    ],
    "errors": []
  }
  ```
- **Validation**:
  - All content IDs must belong to requesting user
  - Max 100 items per bulk operation (performance limit)
  - Action must be valid: approve|reject|delete
  - If reject action, notes required (10-500 chars)
- **Processing Strategy**:
  - Use MongoDB bulk operations or batch inserts
  - Process items individually to track successes/failures
  - Return detailed result for each item
  - Rollback on critical errors or partial success only

### Frontend (To Be Implemented)
- **Component**: Content list page (VIP-10301) with bulk selection
- **Requirements**:
  - Checkboxes for each content item
  - "Select All" checkbox in header
  - Selected count indicator: "X items selected"
  - Bulk action button group visible only when items selected
  - Buttons: "Approve All", "Reject All", "Delete All"
  - Modal dialog for bulk reject with notes textarea
  - Modal dialog for delete confirmation
  - Progress bar during operation showing "X/Y processed"
  - Toast/notification on completion with success count
  - Update list to reflect changes

### Selection UI
```
[☐] Select All          │ 5 items selected
─────────────────────────┼─────────────────────
[☐] Content Title 1     │ [Approve All] [Reject All] [Delete All]
[☑] Content Title 2     │
[☑] Content Title 3     │
[☐] Content Title 4     │
[☑] Content Title 5     │
```

### Bulk Actions Dialog
- **For Approve**: Simple confirmation "Approve all 5 selected items?"
- **For Reject**: Textarea for rejection notes (10-500 chars) to apply to all
- **For Delete**: Confirmation with count "Delete 5 items permanently?"

## Definition of Done

- [x] Story details defined
- [ ] Create POST /api/content/bulk-actions endpoint
- [ ] Add input validation (contentIds, action, notes if reject)
- [ ] Implement MongoDB batch operations
- [ ] Add user isolation checks for all items
- [ ] Frontend checkbox selection implemented
- [ ] "Select All" checkbox implemented
- [ ] Selected count display implemented
- [ ] Bulk action buttons implemented
- [ ] Bulk reject dialog with notes implemented
- [ ] Bulk delete confirmation implemented
- [ ] Progress indicator during processing
- [ ] Success/error notifications
- [ ] List updates after bulk action
- [ ] All acceptance criteria met
- [ ] Unit tests written (especially error cases)
- [ ] E2E tests passing
- [ ] Code reviewed and approved
- [ ] Merged to main branch

## Performance Considerations

### Scalability
- Limit bulk operations to max 100 items per request
- Use MongoDB bulk operations for efficiency
- Process items in batches (10-20 at a time)
- Return progress updates for large batches

### Client-Side
- Disable checkboxes during bulk operation
- Disable bulk action buttons during processing
- Show loading spinners on selected items
- Update UI as items complete

### Error Handling
- Partial success OK: Some items succeed, others fail
- Return detailed error for each failed item
- Allow user to retry failed items
- Log bulk operation in audit trail

## Security Notes

### Critical: User Isolation
- Verify ALL content IDs belong to `user.userId`
- Do NOT process items from other users
- Return error if any item doesn't belong to user
- Prevent bulk operation bypass of ownership checks

### Validation
- Server-side validation of all inputs
- Max 100 items (prevent DoS)
- Validate action type
- Validate contentIds are ObjectIds

## Related Stories
- VIP-10304: Approve Workflow (single approval logic)
- VIP-10305: Reject Workflow (single rejection logic)
- VIP-10301: List Content (selection UI location)

## Notes

- New endpoint to create
- Consider adding scheduled bulk operations (approve items matching criteria)
- Could add "Undo" functionality for bulk operations
- Bulk stats: "You've processed 150 items in bulk this month"
