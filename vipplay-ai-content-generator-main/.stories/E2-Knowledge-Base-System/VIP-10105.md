# VIP-10105: Fetch and Parse RSS Articles

**Story ID**: VIP-10105
**Story Type**: Story
**Epic**: E2-Knowledge-Base-System
**Priority**: High
**Story Points**: 5
**Status**: To Do

## User Story

As a system, I want to automatically fetch RSS articles so that the knowledge base stays current

## Acceptance Criteria

- [ ] **AC1**: System fetches RSS articles from configured feed URLs
- [ ] **AC2**: Articles are parsed and stored in MongoDB with proper metadata
- [ ] **AC3**: Duplicate articles are detected and prevented (by URL or GUID)
- [ ] **AC4**: Article content includes title, description, link, publish date, and author
- [ ] **AC5**: Articles are linked to their source RSS feed in the database

## Technical Details

**Architecture:**
- Next.js API routes handle database operations and orchestration
- FastAPI service handles heavy lifting (RSS fetching and parsing)
- Communication: Next.js → FastAPI → RSS Feed → FastAPI → Next.js

**Next.js Endpoint:**
- `POST /api/sources/{sourceId}/fetch` - Validate source, call FastAPI, store articles
- JWT authentication required
- MongoDB operations for storing articles

**FastAPI Endpoint:**
- `POST /rss/fetch` - Fetch and parse RSS/Atom feed

**RSS Parsing (FastAPI):**
- Parse RSS/Atom feeds using Python's xml.etree.ElementTree
- Extract fields: title, description, link, pubDate, author, content, guid
- Handle both RSS 2.0 and Atom feed formats
- Extract keywords/tags from feed items if available
- Support for enclosures (media attachments)

**Data Model (Article):**
```typescript
{
  _id: ObjectId,
  sourceId: ObjectId,
  userId: ObjectId,
  type: 'rss' | 'website' | 'manual',
  title: string,
  content: string,
  summary?: string,
  url: string,
  guid?: string,  // RSS GUID for duplicate detection
  author?: string,
  publishedDate?: Date,
  keywords: string[],
  capturedDate: Date,
  createdAt: Date,
  updatedAt: Date
}
```

**Duplicate Detection:**
- Check for existing article by URL (primary)
- Check for existing article by GUID (secondary, RSS-specific)
- Update existing article if found, otherwise create new

**Error Handling:**
- Handle invalid RSS feed URLs
- Handle network errors and timeouts
- Handle malformed RSS XML
- Log errors for monitoring

## Definition of Done

- [ ] Code implemented and working
- [ ] All acceptance criteria met
- [ ] Unit tests written and passing
- [ ] Code reviewed and approved
- [ ] Merged to main branch
- [ ] Documented

## Notes

**Implementation Status**: ✅ Code Complete

**Architecture Implementation**:
1. ✅ FastAPI Service (`api-service/`):
   - Created `services/rss_service.py` - RSS/Atom feed fetching and parsing
   - Created `routers/rss.py` - RSS endpoint (POST /rss/fetch)
   - Created `models/rss_models.py` - Pydantic models for requests/responses
   - Integrated RSS router into `main.py`

2. ✅ Next.js Backend (`app/api/`):
   - Updated `app/api/sources/[sourceId]/fetch/route.ts` to call FastAPI endpoint
   - Removed direct RSS parsing from Next.js (`lib/services/rss-parser.ts` deleted)
   - MongoDB operations: duplicate detection, bulk insert, update counts

**Correct Data Flow**:
- User → Next.js (auth, DB) → FastAPI (RSS fetching) → RSS Feed
- Separation of concerns: Next.js = orchestration + DB, FastAPI = external data fetching

**Endpoints Ready**:
- Next.js: `POST /api/sources/{sourceId}/fetch` → Validates & calls FastAPI
- FastAPI: `POST /rss/fetch` → Fetches and parses RSS/Atom feed

**Code Quality**:
- JWT authentication enforced (Next.js)
- Source ownership verified (Next.js)
- Duplicate detection by URL and GUID (Next.js)
- Supports both RSS 2.0 and Atom formats (FastAPI)
- Proper error handling (400, 404, 500, 503)
- Bulk insert for efficiency (MongoDB)
- Article count updates automatically (MongoDB)
- Clean separation of concerns (Next.js vs FastAPI)
