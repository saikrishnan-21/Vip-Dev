# VIP-10101: Add RSS Feed Source

**Story ID**: VIP-10101
**Story Type**: Story
**Epic**: E2-Knowledge-Base-System
**Priority**: High
**Story Points**: 3
**Status**: In Progress

## User Story

As a user, I want to add RSS feeds so that I can automatically capture articles from my favorite sources

## Acceptance Criteria

- [x] **AC1: Add RSS Feed via Dialog**
  - User can access "Add RSS Feed" dialog from Knowledge Base page via "Add Source" â†’ "RSS Feed" dropdown menu
  - Dialog displays three input fields: Feed Name (required, min 2 chars), Feed URL (required, valid URL), Description (optional)
  - Dialog shows loading state during submission with spinner and "Adding..." text
  - Cancel button closes dialog without saving

- [x] **AC2: Create RSS Source via API**
  - POST request to `/api/sources/rss` with authenticated JWT token
  - Request body validated with Zod schema (name, feedUrl, description)
  - Source saved to MongoDB `sources` collection with default values: `fetchFrequency=60`, `articlesCount=0`, `status='active'`
  - Returns 201 Created on success with source object

- [x] **AC3: Duplicate Feed Prevention**
  - System checks if feedUrl already exists for the authenticated user
  - Returns 400 Bad Request with message "RSS feed already added" if duplicate found
  - Different users CAN add the same feedUrl (user isolation)

- [x] **AC4: Validation & Error Handling**
  - Name: min 2 characters, required
  - Feed URL: valid URL format, required
  - Fetch Frequency: 15-1440 minutes (optional, defaults to 60)
  - Validation errors returned with field-specific messages
  - Frontend displays validation errors in red banner at top of dialog

- [x] **AC5: Success Feedback**
  - Success toast notification appears: "RSS Feed Added - Successfully added {name}"
  - Dialog closes automatically on success
  - Form fields reset to empty
  - Optional onSuccess callback triggered to refresh source list

## Technical Details

**Frontend**:
- Component: `components/add-rss-dialog.tsx`
- Controlled dialog state with `open`, `onOpenChange`, `hideTrigger` props
- JWT token retrieved from localStorage
- Toast notifications via `useToast` hook
- Error state management with error banner display

**Backend**:
- Route: `app/api/sources/rss/route.ts`
- Middleware: `withAuth` (JWT authentication required)
- Validation: `createRSSSourceSchema` from `lib/validations/source.ts`
- Database: MongoDB `sources` collection via `getDatabase()`

**Database Schema**:
```typescript
{
  _id: ObjectId,
  userId: ObjectId,
  type: 'rss',
  name: string,
  description?: string,
  status: 'active' | 'paused' | 'error',
  feedUrl: string,
  lastFetchedAt?: Date,
  fetchFrequency: number, // minutes
  articlesCount: number,
  createdAt: Date,
  updatedAt: Date
}
```

## Definition of Done

- [x] Frontend dialog component implemented with all required fields
- [x] Backend API endpoint implemented with authentication and validation
- [x] Duplicate prevention logic working
- [x] Error handling for validation, duplicates, and server errors
- [x] Success feedback with toast notifications
- [ ] Browser/UI testing completed
- [ ] All test scenarios passing
- [ ] Code committed and pushed to story branch
- [ ] Story branch merged to epic branch

## Notes

- No actual RSS fetching implemented in this story (deferred to VIP-10105)
- Knowledge Base page currently uses mock data (expected limitation)
- Firecrawl integration NOT included in this story (future enhancement)
